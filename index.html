<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script
			src="https://cdn.jsdelivr.net/gh/alfg/ping.js@0.2.2/dist/ping.min.js"
			type="text/javascript"
		></script>
		<title>Simple CDN</title>
		<link rel="icon" type="image/x-icon" href="package.png" />
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
			integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
			crossorigin="anonymous"
		/>
		<link
			href="https://fonts.googleapis.com/css?family=Space Mono"
			rel="stylesheet"
		/>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
			integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
			crossorigin="anonymous"
		></script>
		<style>
			body {
				font-family: 'Space Mono';
				font-size: 22px;
				background-color: #e7eaf0;
			}
			#card {
				width: 80vw;
				height: 80vh;
				margin-top: 10vh;
				margin-left: 10vw;
				border-radius: 50px;
				-webkit-box-shadow: 0 0 10px #e7eaf021;
				box-shadow: 0 0 10px #17181b21;
				display: flex;
				align-self: center;
				justify-content: center;
				background-color: white;
			}
			.right {
				width: 60%;
				height: 100%;
				flex-direction: column;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: xx-large;
			}
			.left {
				width: 40%;
				height: 100%;
				flex-direction: column;
				display: flex;
				margin-left: 40px;
			}
			#selection {
				display: flex;
				justify-content: center;
				align-items: center;
				gap: 10vw;
			}
			.cardItems {
				width: 300px;
				height: 300px;
				background-color: #2b4865;
				border-radius: 20px;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				gap: 10px;
			}
			.lightText {
				color: #e7eaf0;
			}

			#feature1,
			#feature2 {
				display: flex;
				align-items: center;
				justify-content: flex-start;
				width: 100%;
			}

			.hidden {
				display: none !important;
			}
			.back {
				cursor: pointer;
				margin-top: 20px;
			}
			.map {
				margin-top: 60px;
				width: 100%;
			}
			@media only screen and (max-width: 900px) {
				p {
					font-size: medium;
				}
				#selection {
					flex-direction: column;
					gap: 10vh;
				}
				.cardItems {
					width: 200px;
					height: 200px;
				}
				#feature1,
				#feature2 {
					flex-direction: column;
				}
				.left {
					margin-left: 0;
					width: 90%;
				}
				.right {
					width: 90%;
				}
				#card {
					height: 90vh;
					margin-top: 5vh;
				}
				#map2 {
					margin-top: 30px !important;
				}
				.textSmall {
					font-size: small;
				}
				#map1 {
					margin-top: 10px !important;
				}
			}
		</style>
	</head>
	<body>
		<div id="card">
			<div class="hidden" id="selection">
				<div class="cardItems" onclick="selectFeature('select')">
					<img src="server.png" alt="select server" width="55%" />
					<p class="lightText">Select Server</p>
				</div>
				<div class="cardItems" onclick="selectFeature('leaderboard')">
					<img src="leaderboard.png" alt="select server" width="55%" />
					<p class="lightText">Leaderboard</p>
				</div>
			</div>
			<div class="hidden" id="feature1">
				<div class="left">
					<img
						src="left-arrow.png"
						alt="back"
						width="40px"
						class="back"
						onclick="selectFeature('feature1')"
					/>
					<img src="map.jpg" alt="map" class="map" id="map1" />
					<p style="margin-top: 40px">Select an availability zone!</p>
					<select title="location" name="location" id="location">
						<option disabled selected>Select a zone!</option>
						<option value="us-west-1 California">California</option>
						<option value="ap-east-1 Hong-Kong">Hong Kong</option>
						<option value="eu-west-1 Ireland">Ireland</option>
						<option value="ap-southeast-3 Jakarta">Jakarta</option>
						<option value="eu-west-2 London">London</option>
						<option value="us-east-2 Ohio">Ohio</option>
						<option value="us-west-2 Oregon">Oregon</option>
						<option value="ap-southeast-1 Singapore">Singapore</option>
						<option value="us-east-1 Virginia">Virginia</option>
					</select>
					<button
						type="button"
						onclick="pingTest()"
						style="margin-top: 20px; background-color: #2b4865; color: white"
					>
						Ping!
					</button>
				</div>
				<div class="right">
					<p id="ping"></p>
					<p id="zone" style="margin-bottom: 0"></p>
					<p id="zonecode"></p>
				</div>
			</div>
			<div id="feature2">
				<div class="left">
					<img
						src="left-arrow.png"
						alt="back"
						width="40px"
						class="back"
						onclick="selectFeature('feature2')"
					/>
					<img
						src="map.jpg"
						alt="map"
						class="map"
						style="margin-top: 120px"
						id="map2"
					/>

					<button
						type="button"
						onclick="pingAll()"
						style="margin-top: 20px; background-color: #2b4865; color: white"
					>
						Ping!
					</button>
				</div>
				<div class="right" id="leaderboard"></div>
			</div>
		</div>

		<script>
			var p = new Ping();

			function pingTest() {
				let location = document.getElementById('location').value;
				let zone = location.split(' ')[0];
				let country = location.split(' ')[1].replace('-', ' ');
				p.ping(`https://dynamodb.${zone}.amazonaws.com`, function (err, data) {
					// Also display error if err is returned.

					document.getElementById('ping').innerHTML = data + 'ms';
					document.getElementById('zone').innerHTML = country;
					document.getElementById('zonecode').innerHTML = zone;
				});
			}

			var state = 'none';

			function selectFeature(feature) {
				state = feature;
				if (feature == 'select') {
					document.getElementById('selection').classList.add('hidden');
					document.getElementById('feature1').classList.remove('hidden');
				} else if (feature == 'leaderboard') {
					document.getElementById('selection').classList.add('hidden');
					document.getElementById('feature2').classList.remove('hidden');
				} else {
					document.getElementById(feature).classList.add('hidden');
					document.getElementById('selection').classList.remove('hidden');
				}
			}

			const locationDict = {
				'us-west-1': 'California',
				'ap-east-1': 'Hong-Kong',
				'eu-west-1': 'Ireland',
				'ap-southeast-3': 'Jakarta',
				'eu-west-2': 'London',
				'us-east-2': 'Ohio',
				'us-west-2': 'Oregon',
				'ap-southeast-1': 'Singapore',
				'us-east-1': 'Virginia',
			};

			var pingDict = [];

			function pingAll() {
				let count = 0;
				pingDict = [];
				for (const [key, value] of Object.entries(locationDict)) {
					p.ping(`https://dynamodb.${key}.amazonaws.com`, function (err, data) {
						// Also display error if err is returned.
						pingDict[count++] = key + ' ' + value + ' ' + data;
						if (count == 9) {
							displayLeaderboard();
						}
					});
				}
			}

			function displayLeaderboard() {
				sortArray();
				let leaderboard = document.getElementById('leaderboard');
				leaderboard.innerHTML = '';
				for (let x = 0; x < 5; x++) {
					let location = pingDict[x].split(' ')[0];
					let country = pingDict[x].split(' ')[1].replace('-', ' ');
					let ping = pingDict[x].split(' ')[2];

					let item = document.createElement('div');
					item.classList.add('item');
					let z = document.createElement('p');
					z.innerHTML = country + ' ' + location + ' ' + ping + 'ms';
					z.classList.add('textSmall');
					item.append(z);
					leaderboard.append(item);
				}
			}

			function sortArray() {
				let arr = Object.values(pingDict);
				arr.sort(function (a, b) {
					return a.split(' ')[2] - b.split(' ')[2];
				});
			}
		</script>
	</body>
</html>
